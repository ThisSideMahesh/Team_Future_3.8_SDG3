{
  "entities": {
    "Institution": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Institution",
      "type": "object",
      "description": "Represents a healthcare institution.",
      "properties": {
        "institution_id": { "type": "string" },
        "name": { "type": "string" },
        "city": { "type": "string" },
        "state": { "type": "string" },
        "status": { "type": "string", "enum": ["ACTIVE", "PENDING", "SUSPENDED"] },
        "created_at": { "type": "string", "format": "date-time" }
      },
      "required": ["institution_id", "name", "city", "state", "status"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user with a specific role in the system.",
      "properties": {
        "user_id": { "type": "string" },
        "name": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "role": { "type": "string", "enum": ["healthcare_provider", "institution_admin", "platform_admin", "patient"] },
        "institution_id": { "type": "string", "description": "Required if role is not platform_admin or patient." },
        "active": { "type": "boolean" },
        "avatarUrl": { "type": "string", "format": "uri" }
      },
      "required": ["user_id", "name", "email", "role", "active"]
    },
    "Patient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Patient",
      "type": "object",
      "description": "Represents a patient's identity information.",
      "properties": {
        "patient_id": { "type": "string" },
        "name": { "type": "string" },
        "dob": { "type": "string", "format": "date" },
        "gender": { "type": "string" },
        "primary_institution": { "type": "string" },
        "avatarUrl": { "type": "string", "format": "uri" }
      },
      "required": ["patient_id", "name", "dob"]
    },
    "Consent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Consent",
      "type": "object",
      "description": "Represents a patient's consent for data aggregation.",
      "properties": {
        "consent_id": { "type": "string" },
        "patient_id": { "type": "string" },
        "granted": { "type": "boolean" },
        "last_updated": { "type": "string", "format": "date-time" }
      },
      "required": ["consent_id", "patient_id", "granted"]
    },
    "Record": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Record",
      "type": "object",
      "description": "Represents a patient's unified health record.",
      "properties": {
        "record_id": { "type": "string" },
        "patient_id": { "type": "string" },
        "institution_id": { "type": "string" },
        "blood_group": { "type": "string" },
        "conditions": { "type": "array", "items": { "type": "string" } },
        "medications": { "type": "array", "items": { "type": "string" } },
        "allergies": { "type": "array", "items": { "type": "string" } },
        "lab_reports": { "type": "array", "items": { "type": "string" } },
        "last_updated": { "type": "string", "format": "date-time" }
      },
      "required": ["record_id", "patient_id"]
    },
    "EmergencyAccessLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EmergencyAccessLog",
      "type": "object",
      "description": "Represents an audit log for emergency data access.",
      "properties": {
        "log_id": { "type": "string" },
        "patient_id": { "type": "string" },
        "healthcare_provider_id": { "type": "string" },
        "institution_id": { "type": "string" },
        "reason": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      },
      "required": ["log_id", "patient_id", "healthcare_provider_id", "institution_id", "reason"]
    },
    "ApiCredential": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ApiCredential",
      "type": "object",
      "description": "Represents API credentials for an institution.",
      "properties": {
        "credential_id": { "type": "string" },
        "institution_id": { "type": "string" },
        "api_key": { "type": "string" },
        "enabled": { "type": "boolean" },
        "created_at": { "type": "string", "format": "date-time" }
      },
      "required": ["credential_id", "institution_id", "api_key", "enabled"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/institutions/{institutionId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/Institution" },
          "description": "Stores healthcare institution profiles."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores all user profiles, distinguished by a 'role' field."
        }
      },
      {
        "path": "/patients/{patientId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/Patient" },
          "description": "Stores patient identity information."
        }
      },
      {
        "path": "/consents/{consentId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/Consent" },
          "description": "Stores patient consent records."
        }
      },
      {
        "path": "/records/{recordId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/Record" },
          "description": "Stores unified health records."
        }
      },
      {
        "path": "/emergency_access_logs/{logId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/EmergencyAccessLog" },
          "description": "Stores audit logs for emergency access."
        }
      },
      {
        "path": "/api_credentials/{credentialId}",
        "definition": {
          "schema": { "$ref": "#/backend/entities/ApiCredential" },
          "description": "Stores API credentials for institutions."
        }
      }
    ]
  }
}
